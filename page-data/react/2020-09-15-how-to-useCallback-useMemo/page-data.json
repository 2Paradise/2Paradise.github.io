{"componentChunkName":"component---src-templates-post-template-tsx","path":"/react/2020-09-15-how-to-useCallback-useMemo/","result":{"data":{"site":{"siteMetadata":{"title":"2P Enginnering Blog","author":"@2Paradise"}},"post":{"fields":{"slug":"/react/2020-09-15-how-to-useCallback-useMemo/"},"frontmatter":{"title":"useCallback , useMemo 어떻게 써야 할까?","hide":false,"type":"post","date":"2020-09-15","desc":"React를 사용함에 있어서 기본적으로 최적화 이슈와 함께 고민해야 할 부분인 메모제이션 훅 useCallback, useMemo 에 대한 이해의 필요성을 느끼게 되어 여러 문서들을 참고해 정리해 보고자 한다.","tag":["React","useCallback","useMemo","React Hook"]},"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 840px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/de44bb3035c73e878efd3e753bd2329b/1cfc2/useMemoUseCallback.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4klEQVQoz51QwWqEMBD1l/s/hX5IDwoKnsSDBaUH6e7K6iVWaDExmnmbmWUXd5tTH7xMMpN5mZcIHo5ISJ4MCuyfeavtIyPaH0ICIXC+7/ugaMTL10IoZ4KVpBfaNc/zjGmaYIyB1loax3FE0zRY1/XvhCzwqggvZ8LJXgtsf9s22bdtiziOUZYlqqqCUkoe6Lruete55wkJ7z+EN+Xw6xPd8YA4SZB4pmmKuq5FrCgKiXmeI8uyO4dheBQ0jvChCZ+G8O2HIm9De3vLsohNa61Etsc5PjNv9cCED7+N/2D/hxdL+x2sgNJN5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"useMemoUseCallback\"\n        title=\"useMemoUseCallback\"\n        src=\"/static/de44bb3035c73e878efd3e753bd2329b/1e088/useMemoUseCallback.png\"\n        srcset=\"/static/de44bb3035c73e878efd3e753bd2329b/65ed1/useMemoUseCallback.png 210w,\n/static/de44bb3035c73e878efd3e753bd2329b/d10fb/useMemoUseCallback.png 420w,\n/static/de44bb3035c73e878efd3e753bd2329b/1e088/useMemoUseCallback.png 840w,\n/static/de44bb3035c73e878efd3e753bd2329b/1cfc2/useMemoUseCallback.png 900w\"\n        sizes=\"(max-width: 840px) 100vw, 840px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>React를 사용함에 있어서 기본적으로 최적화 이슈와 함께 고민해야 할 부분인 메모제이션 훅 useCallback, useMemo 에 대한 이해의 필요성을 느끼게 되어 여러 문서들을 참고해 정리해 보고자 한다. </p>\n<p>useCallback과 useMemo의 차이를 간략히 정리하자면 다음과 같이 설명할 수 있다.</p>\n<ul>\n<li>useMemo : <strong>함수의 return 값</strong>을 기억</li>\n<li>useCallback: <strong>함수 reference</strong> 를 기억</li>\n</ul>\n<h2>useMemo</h2>\n<hr>\n<p><code class=\"language-text\">useMemo</code> hook은 복잡한 로직에 의해 계산량이 많거나 고비용의 DB 네트워크 호출이 필요한 <strong>함수의 반환 값을 재활용하는 용도</strong>로 사용된다. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> memoizedValue <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">computeExpensiveValue</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>첫번째 매개변수로 함수를 전달하며 <code class=\"language-text\">useMemo</code> hook은 이 함수의 return value를 기억한다. 두번째 매개변수는 의존성 배열로 이 값이 변경되지 않으면 이전 return value를 재사용하는 방식이다. </p>\n<h2>useCallback</h2>\n<hr>\n<p><code class=\"language-text\">useCallback hook</code>은 함수의 reference를 반환한다. 즉 메모제이션된 콜백을 반환하는 것이다. 때문에 엄밀히 살펴 보자면 <code class=\"language-text\">useCallback(fn, deps)</code> 는 <code class=\"language-text\">useMemo(() ⇒ fn, deps)</code> 와 같다고 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> memoizedCallback <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>브라우저에서 함수 생성 자체가 성능에 미치는 영향은 작다고 하지만 prop으로 전달되는 함수의 경우 매번 그 참조값이 바뀌기 때문에 자식 컴포넌트에서 <code class=\"language-text\">React.Memo</code>를 사용해도 불필요한 렌더링이 발생될 수 밖에 없다. 이러한 문제를 해결하기 위해 <code class=\"language-text\">useCallback</code>이 필요하다. </p>\n<h2>그렇다면 언제 useMemo, useCallback를 사용해야 할까?</h2>\n<hr>\n<ol>\n<li>레퍼런스 (메모리 값) 이 동일한지 비교 - (Referential equality)</li>\n<li>컴퓨터를 활용하는 비싼 연산 (Computationally expensive calculations)</li>\n</ol>\n<h3>Referential equality</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token boolean\">true</span> <span class=\"token operator\">===</span> <span class=\"token boolean\">true</span> <span class=\"token comment\">// true</span>\n<span class=\"token boolean\">false</span> <span class=\"token operator\">===</span> <span class=\"token boolean\">false</span> <span class=\"token comment\">// true</span>\n<span class=\"token number\">1</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span> <span class=\"token comment\">// true</span>\n<span class=\"token string\">'a'</span> <span class=\"token operator\">===</span> <span class=\"token string\">'a'</span> <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">===</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">// false</span>\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// false</span>\n<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">===</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">// false</span>\n<span class=\"token keyword\">const</span> z <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nz <span class=\"token operator\">===</span> z <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// NOTE: React actually uses Object.is, but it's very similar to ===</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>React에서 리랜더링을 위해 prop 이 갱신되었는지를 비교할 때, 그리고 의존성 배열이 필요한 react hooks 에서도  레퍼런스 비교를 위해 <a href=\"http://object.ishttps://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object/is#Description\">Object.is</a> 를 활용한 비교를 적용한다. 이 비교 방법에 따라 리랜더링 되는 조건에 대한 이해가 된다면 <code class=\"language-text\">useCallback</code> 의 사용 이유 가 명확해 진다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">DualCounter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count1<span class=\"token punctuation\">,</span> setCount1<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">increment1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount1</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count2<span class=\"token punctuation\">,</span> setCount2<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">increment2</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount2</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>CountButton count<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>count1<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>increment1<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>CountButton count<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>count2<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>increment2<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>여기서 두 버튼 중 어떤 것을 누르더라도 두 개의 <code class=\"language-text\">CountButton</code> 은 다시 랜더링된다.</p>\n<ol>\n<li>상태 업데이트</li>\n<li><code class=\"language-text\">DualCounter</code> 내부의 변수 재생성 (<code class=\"language-text\">increment1</code>, <code class=\"language-text\">increment2</code>)</li>\n<li>각각의 <code class=\"language-text\">CountButton</code> 은 다른 버튼의 상태와 전혀 상관 없이 내려받는 함수들이 새로 생성되었기 때문에 다시 랜더링</li>\n</ol>\n<p>이 “불필요한 리랜더링” 문제를 해결하려면 <code class=\"language-text\">CountButton</code> 과 <code class=\"language-text\">DualCounter</code> 두 컴포넌트 모두 최적화해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> CountButton <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">memo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">CountButton</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> onClick<span class=\"token punctuation\">,</span> count <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onClick<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">DualCounter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count1<span class=\"token punctuation\">,</span> setCount1<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> increment1 <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount1</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count2<span class=\"token punctuation\">,</span> setCount2<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> increment2 <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount2</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>CountButton count<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>count1<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>increment1<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>CountButton count<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>count2<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>increment2<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<hr>\n<p> 실행되는 모든 코드는 각각 한 줄마다 비용이 발생한다. 실제로 퍼포먼스 개선이 없는 부분에서 <code class=\"language-text\">useCallback</code> 호출, 의존성 배열( <code class=\"language-text\">[]</code> )을 선언함으로 리소스를 더 잡아먹게 될 수가 있다는 것이다. 또한 함수 자체를 메모제이션을 하기 위해 추가로 메모리를 선점하게 된다. </p>\n<h3>it's best to measure first.</h3>\n<p> 모든 최적화에는 비용이 발생한다. 때문에 정확한 퍼포먼스 측정이 선행된 최적화를 통해 성급한 최적화를 피해야 한다. </p>\n<p>의존성 배열이 필요한 hook 사용 시, 함수 안에서 참조되는 모든 값은 의존성 배열에 포함되어 있어야 하기 때문에 의존성이 바르게 정의 될 수 있도록 돕는 패치지 설치를 권장한다. </p>\n<ul>\n<li><a href=\"https://www.npmjs.com/package/eslint-plugin-react-hooks#installation\">eslint-plugin-react-hooks</a> 패키지의 일부인 <a href=\"https://github.com/facebook/react/issues/14920\">exhaustive-deps</a> 규칙 사용 권장</li>\n</ul>\n<h3>참조</h3>\n<ul>\n<li><a href=\"https://kentcdodds.com/blog/usememo-and-usecallback\">When to useMemo and useCallback - (Kent C. Dodds post)</a></li>\n<li><a href=\"https://linguinecode.com/post/react-usememo-usecallback-hook\">How to use React useMemo and useCallback hook - (Linguine Code post)</a></li>\n<li><a href=\"https://ko.reactjs.org/docs/hooks-reference.html#usememo\">Hooks API Reference</a></li>\n<li>실전 리액트 프로그래밍 (이재승 지음)</li>\n</ul>","id":"d4b7767f-7cfb-5f65-be4c-9fbbfae65278"}},"pageContext":{}},"staticQueryHashes":["2274161303","405191750"]}